var __extends = (this && this.__extends) || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
define(["require", "exports", "Models"], function (require, exports, modelsFile) {
    var bb = Backbone;
    var models = modelsFile.Models;
    var Views;
    (function (Views) {
        // todo
        var ProductsStatusView = (function (_super) {
            __extends(ProductsStatusView, _super);
            function ProductsStatusView(options) {
                _super.call(this, options);
                this.bind('change', this.modelChanged, this);
            }
            ProductsStatusView.prototype.modelChanged = function () {
                var _this = this;
                this.lineItems = new Array();
                this.model.Lines.forEach(function (line) {
                    _this.lineItems.push(models.Collections().Lines.get(line.LineId));
                });
            };
            return ProductsStatusView;
        })(bb.View);
        Views.ProductsStatusView = ProductsStatusView;
        // list view of products
        var ProductsListView = (function (_super) {
            __extends(ProductsListView, _super);
            function ProductsListView() {
                _super.apply(this, arguments);
            }
            ProductsListView.prototype.render = function () {
                var _this = this;
                // clear
                this.$el.html('');
                // collection
                this.collection.each(function (p) {
                    // append it
                    var plw = new ProductListView;
                    plw.model = p;
                    // "view chaining"
                    _this.$el.append(plw.render().el);
                }, this);
                return this;
            };
            return ProductsListView;
        })(bb.View);
        Views.ProductsListView = ProductsListView;
        // single item in list
        var ProductListView = (function (_super) {
            __extends(ProductListView, _super);
            function ProductListView() {
                this.events = {
                    "click .editButton": "modelEdit",
                    "click .deleteButton": "modelDelete",
                    "click .saveButton": "modelSave",
                    "click .cancelButton": "modelCancel",
                    "click .lineAddButton": "modelAddLine",
                    "click .lineDeleteButton": "modelDeleteLine"
                };
                _super.call(this);
                this.template = _.template($('#productList-template').html());
            }
            ProductListView.prototype.render = function () {
                this.$el.html(this.template(this.model.toJSON()));
                if (this.editing) {
                    var lsv = new LinesSelectView;
                    var lineSelectorHtml = lsv.render().el;
                    this.$el.find('div[class=lineSelect]')
                        .append(lineSelectorHtml);
                }
                return this;
            };
            ProductListView.prototype.modelEdit = function () {
                this.template = _.template($('#productListEdit-template').html());
                this.editing = true;
                this.render();
            };
            ProductListView.prototype.modelSave = function () {
                this.model.Name = this.$el.find('input[name=Name]').val();
                this.model.save();
                this.editing = false;
                this.template = _.template($('#productList-template').html());
                this.render();
            };
            ProductListView.prototype.modelCancel = function () {
                this.template = _.template($('#productList-template').html());
                this.editing = false;
                this.render();
            };
            ProductListView.prototype.modelAddLine = function () {
                debugger;
                var lineId = parseInt(this.$el.find('div[class=lineSelect]')
                    .find('select').val());
                if (lineId > 0) {
                    if (this.model.Lines == null) {
                        this.model.Lines = new Array();
                    }
                    var pl = new models.ProductLine;
                    pl.ProductId = this.model.id;
                    pl.LineId = lineId;
                    this.model.Lines.push(pl);
                    this.model.save();
                }
            };
            ProductListView.prototype.modelDeleteLine = function (e) {
                debugger;
                var lineId = parseInt($(e.target).attr('data-lineId'));
                if (lineId > 0) {
                    this.model.Lines = this.model.Lines.filter(function (pl) { return pl.LineId != lineId; });
                    this.model.save();
                }
            };
            ProductListView.prototype.modelDelete = function () {
                this.model.destroy();
            };
            return ProductListView;
        })(bb.View);
        Views.ProductListView = ProductListView;
        // list view
        var LinesListView = (function (_super) {
            __extends(LinesListView, _super);
            function LinesListView() {
                _super.apply(this, arguments);
            }
            LinesListView.prototype.render = function () {
                var _this = this;
                // clear
                this.$el.html('');
                // collection
                this.collection.each(function (l) {
                    // append it
                    var llw = new LineListView;
                    llw.model = l;
                    // "view chaining"
                    _this.$el.append(llw.render().el);
                }, this);
                return this;
            };
            return LinesListView;
        })(bb.View);
        Views.LinesListView = LinesListView;
        // single item in list
        var LineListView = (function (_super) {
            __extends(LineListView, _super);
            function LineListView() {
                this.events = {
                    "click .editButton": "modelEdit",
                    "click .deleteButton": "modelDelete",
                    "click .saveButton": "modelSave",
                    "click .cancelButton": "modelCancel"
                };
                _super.call(this);
                this.template = _.template($('#lineList-template').html());
            }
            LineListView.prototype.render = function () {
                this.$el.html(this.template(this.model.toJSON()));
                return this;
            };
            LineListView.prototype.modelEdit = function () {
                this.template = _.template($('#lineListEdit-template').html());
                this.render();
            };
            LineListView.prototype.modelSave = function () {
                this.model.Name = this.$el.find('input[name=Name]').val();
                this.model.save();
                this.template = _.template($('#lineList-template').html());
                this.render();
            };
            LineListView.prototype.modelCancel = function () {
                this.template = _.template($('#lineList-template').html());
                this.render();
            };
            LineListView.prototype.modelDelete = function () {
                this.model.destroy();
            };
            return LineListView;
        })(bb.View);
        Views.LineListView = LineListView;
        // alternative list view of lines as <select> element
        var LinesSelectView = (function (_super) {
            __extends(LinesSelectView, _super);
            function LinesSelectView(options) {
                this.collection = models.Collections().Lines;
                _super.call(this, options);
            }
            LinesSelectView.prototype.render = function () {
                var _this = this;
                // select
                this.el = $('<select class="option">');
                this.collection.each(function (l) {
                    // option
                    var lov = new LineOptionView;
                    lov.model = l;
                    // append
                    _this.el.append(lov.render().el);
                }, this);
                return this;
            };
            return LinesSelectView;
        })(bb.View);
        Views.LinesSelectView = LinesSelectView;
        var LineOptionView = (function (_super) {
            __extends(LineOptionView, _super);
            function LineOptionView() {
                _super.apply(this, arguments);
            }
            LineOptionView.prototype.render = function () {
                this.el = $('<option>');
                this.el.attr('value', this.model.id);
                this.el.text(this.model.Name);
                return this;
            };
            return LineOptionView;
        })(bb.View);
        Views.LineOptionView = LineOptionView;
        // status list view
        var StatusesListView = (function (_super) {
            __extends(StatusesListView, _super);
            function StatusesListView(options) {
                _super.call(this, options);
            }
            StatusesListView.prototype.render = function () {
                var _this = this;
                this.collection.each(function (s) {
                    var slv = new StatusListView;
                    slv.model = s;
                    _this.el.append(slv.render().el);
                }, this);
                return this;
            };
            return StatusesListView;
        })(bb.View);
        Views.StatusesListView = StatusesListView;
        var StatusListView = (function (_super) {
            __extends(StatusListView, _super);
            function StatusListView(options) {
                this.template = _.template($('#statusList-template').html());
                _super.call(this, options);
            }
            StatusListView.prototype.render = function () {
                this.$el.html(this.template(this.model.toJSON()));
                return this;
            };
            return StatusListView;
        })(bb.View);
        Views.StatusListView = StatusListView;
    })(Views = exports.Views || (exports.Views = {}));
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlZpZXdzLnRzIl0sIm5hbWVzIjpbIlZpZXdzIiwiVmlld3MuUHJvZHVjdHNTdGF0dXNWaWV3IiwiVmlld3MuUHJvZHVjdHNTdGF0dXNWaWV3LmNvbnN0cnVjdG9yIiwiVmlld3MuUHJvZHVjdHNTdGF0dXNWaWV3Lm1vZGVsQ2hhbmdlZCIsIlZpZXdzLlByb2R1Y3RzTGlzdFZpZXciLCJWaWV3cy5Qcm9kdWN0c0xpc3RWaWV3LmNvbnN0cnVjdG9yIiwiVmlld3MuUHJvZHVjdHNMaXN0Vmlldy5yZW5kZXIiLCJWaWV3cy5Qcm9kdWN0TGlzdFZpZXciLCJWaWV3cy5Qcm9kdWN0TGlzdFZpZXcuY29uc3RydWN0b3IiLCJWaWV3cy5Qcm9kdWN0TGlzdFZpZXcucmVuZGVyIiwiVmlld3MuUHJvZHVjdExpc3RWaWV3Lm1vZGVsRWRpdCIsIlZpZXdzLlByb2R1Y3RMaXN0Vmlldy5tb2RlbFNhdmUiLCJWaWV3cy5Qcm9kdWN0TGlzdFZpZXcubW9kZWxDYW5jZWwiLCJWaWV3cy5Qcm9kdWN0TGlzdFZpZXcubW9kZWxBZGRMaW5lIiwiVmlld3MuUHJvZHVjdExpc3RWaWV3Lm1vZGVsRGVsZXRlTGluZSIsIlZpZXdzLlByb2R1Y3RMaXN0Vmlldy5tb2RlbERlbGV0ZSIsIlZpZXdzLkxpbmVzTGlzdFZpZXciLCJWaWV3cy5MaW5lc0xpc3RWaWV3LmNvbnN0cnVjdG9yIiwiVmlld3MuTGluZXNMaXN0Vmlldy5yZW5kZXIiLCJWaWV3cy5MaW5lTGlzdFZpZXciLCJWaWV3cy5MaW5lTGlzdFZpZXcuY29uc3RydWN0b3IiLCJWaWV3cy5MaW5lTGlzdFZpZXcucmVuZGVyIiwiVmlld3MuTGluZUxpc3RWaWV3Lm1vZGVsRWRpdCIsIlZpZXdzLkxpbmVMaXN0Vmlldy5tb2RlbFNhdmUiLCJWaWV3cy5MaW5lTGlzdFZpZXcubW9kZWxDYW5jZWwiLCJWaWV3cy5MaW5lTGlzdFZpZXcubW9kZWxEZWxldGUiLCJWaWV3cy5MaW5lc1NlbGVjdFZpZXciLCJWaWV3cy5MaW5lc1NlbGVjdFZpZXcuY29uc3RydWN0b3IiLCJWaWV3cy5MaW5lc1NlbGVjdFZpZXcucmVuZGVyIiwiVmlld3MuTGluZU9wdGlvblZpZXciLCJWaWV3cy5MaW5lT3B0aW9uVmlldy5jb25zdHJ1Y3RvciIsIlZpZXdzLkxpbmVPcHRpb25WaWV3LnJlbmRlciIsIlZpZXdzLlN0YXR1c2VzTGlzdFZpZXciLCJWaWV3cy5TdGF0dXNlc0xpc3RWaWV3LmNvbnN0cnVjdG9yIiwiVmlld3MuU3RhdHVzZXNMaXN0Vmlldy5yZW5kZXIiLCJWaWV3cy5TdGF0dXNMaXN0VmlldyIsIlZpZXdzLlN0YXR1c0xpc3RWaWV3LmNvbnN0cnVjdG9yIiwiVmlld3MuU3RhdHVzTGlzdFZpZXcucmVuZGVyIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0lBQUEsSUFBTyxFQUFFLEdBQUcsUUFBUSxDQUFDO0lBRXJCLElBQU8sTUFBTSxHQUFHLFVBQVUsQ0FBQyxNQUFNLENBQUM7SUFFbEMsSUFBYyxLQUFLLENBNk1sQjtJQTdNRCxXQUFjLEtBQUssRUFBQyxDQUFDO1FBQ2pCQSxBQUNBQSxPQURPQTs7WUFDaUNDLHNDQUF1QkE7WUFFM0RBLDRCQUFZQSxPQUFhQTtnQkFDckJDLGtCQUFNQSxPQUFPQSxDQUFDQSxDQUFDQTtnQkFDZkEsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsUUFBUUEsRUFBRUEsSUFBSUEsQ0FBQ0EsWUFBWUEsRUFBRUEsSUFBSUEsQ0FBQ0EsQ0FBQ0E7WUFDakRBLENBQUNBO1lBQ0RELHlDQUFZQSxHQUFaQTtnQkFBQUUsaUJBS0NBO2dCQUpHQSxJQUFJQSxDQUFDQSxTQUFTQSxHQUFHQSxJQUFJQSxLQUFLQSxFQUFlQSxDQUFDQTtnQkFDMUNBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLEtBQUtBLENBQUNBLE9BQU9BLENBQUNBLFVBQUNBLElBQUlBO29CQUMxQkEsS0FBSUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsV0FBV0EsRUFBRUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsSUFB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QSxDQUFDQTtZQUNMRixxQkFBQ0E7UUFBREEsQ0FWQW5DLEFBVUNtQyxFQVZtQ25DLEVBQUVBLENBQUNBLElBQUlBLEVBVTFDQTtRQVZZQSxvQkFBY0EsaUJBVTFCQSxDQUFBQTtJQUNMQSxDQUFDQSxFQTdNYSxLQUFLLEdBQUwsYUFBSyxLQUFMLGFBQUssUUE2TWxCIiwiZmlsZSI6IlZpZXdzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGJiID0gQmFja2JvbmU7XHJcbmltcG9ydCBtb2RlbHNGaWxlID0gcmVxdWlyZShcIk1vZGVsc1wiKTtcclxuaW1wb3J0IG1vZGVscyA9IG1vZGVsc0ZpbGUuTW9kZWxzO1xyXG5cclxuZXhwb3J0IG1vZHVsZSBWaWV3cyB7XHJcbiAgICAvLyB0b2RvXHJcbiAgICBleHBvcnQgY2xhc3MgUHJvZHVjdHNTdGF0dXNWaWV3IGV4dGVuZHMgYmIuVmlldzxtb2RlbHMuUHJvZHVjdD4ge1xyXG4gICAgICAgIHByaXZhdGUgbGluZUl0ZW1zOiBBcnJheTxtb2RlbHMuTGluZT5cclxuICAgICAgICBjb25zdHJ1Y3RvcihvcHRpb25zPzogYW55KSB7XHJcbiAgICAgICAgICAgIHN1cGVyKG9wdGlvbnMpO1xyXG4gICAgICAgICAgICB0aGlzLmJpbmQoJ2NoYW5nZScsIHRoaXMubW9kZWxDaGFuZ2VkLCB0aGlzKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgbW9kZWxDaGFuZ2VkKCkge1xyXG4gICAgICAgICAgICB0aGlzLmxpbmVJdGVtcyA9IG5ldyBBcnJheTxtb2RlbHMuTGluZT4oKTtcclxuICAgICAgICAgICAgdGhpcy5tb2RlbC5MaW5lcy5mb3JFYWNoKChsaW5lKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmxpbmVJdGVtcy5wdXNoKG1vZGVscy5Db2xsZWN0aW9ucygpLkxpbmVzLmdldChsaW5lLkxpbmVJZCkpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8gbGlzdCB2aWV3IG9mIHByb2R1Y3RzXHJcbiAgICBleHBvcnQgY2xhc3MgUHJvZHVjdHNMaXN0VmlldyBleHRlbmRzIGJiLlZpZXc8bW9kZWxzLlByb2R1Y3Q+IHtcclxuICAgICAgICByZW5kZXIoKTogYmIuVmlldzxtb2RlbHMuUHJvZHVjdD4ge1xyXG4gICAgICAgICAgICAvLyBjbGVhclxyXG4gICAgICAgICAgICB0aGlzLiRlbC5odG1sKCcnKTtcclxuICAgICAgICAgICAgLy8gY29sbGVjdGlvblxyXG4gICAgICAgICAgICB0aGlzLmNvbGxlY3Rpb24uZWFjaChwID0+IHtcclxuICAgICAgICAgICAgICAgIC8vIGFwcGVuZCBpdFxyXG4gICAgICAgICAgICAgICAgdmFyIHBsdyA9IG5ldyBQcm9kdWN0TGlzdFZpZXc7XHJcbiAgICAgICAgICAgICAgICBwbHcubW9kZWwgPSBwO1xyXG4gICAgICAgICAgICAgICAgLy8gXCJ2aWV3IGNoYWluaW5nXCJcclxuICAgICAgICAgICAgICAgIHRoaXMuJGVsLmFwcGVuZChwbHcucmVuZGVyKCkuZWwpO1xyXG4gICAgICAgICAgICB9LCB0aGlzKTtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgLy8gc2luZ2xlIGl0ZW0gaW4gbGlzdFxyXG4gICAgZXhwb3J0IGNsYXNzIFByb2R1Y3RMaXN0VmlldyBleHRlbmRzIGJiLlZpZXc8bW9kZWxzLlByb2R1Y3Q+IHtcclxuICAgICAgICB0ZW1wbGF0ZTogKGRhdGE6IGFueSkgPT4gc3RyaW5nO1xyXG4gICAgICAgIGVkaXRpbmc6IGJvb2xlYW47XHJcbiAgICAgICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZXZlbnRzID0gPGFueT4ge1xyXG4gICAgICAgICAgICAgICAgXCJjbGljayAuZWRpdEJ1dHRvblwiOiBcIm1vZGVsRWRpdFwiLFxyXG4gICAgICAgICAgICAgICAgXCJjbGljayAuZGVsZXRlQnV0dG9uXCI6IFwibW9kZWxEZWxldGVcIixcclxuICAgICAgICAgICAgICAgIFwiY2xpY2sgLnNhdmVCdXR0b25cIjogXCJtb2RlbFNhdmVcIixcclxuICAgICAgICAgICAgICAgIFwiY2xpY2sgLmNhbmNlbEJ1dHRvblwiOiBcIm1vZGVsQ2FuY2VsXCIsXHJcbiAgICAgICAgICAgICAgICBcImNsaWNrIC5saW5lQWRkQnV0dG9uXCI6IFwibW9kZWxBZGRMaW5lXCIsXHJcbiAgICAgICAgICAgICAgICBcImNsaWNrIC5saW5lRGVsZXRlQnV0dG9uXCI6IFwibW9kZWxEZWxldGVMaW5lXCJcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgc3VwZXIoKTtcclxuICAgICAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IF8udGVtcGxhdGUoJCgnI3Byb2R1Y3RMaXN0LXRlbXBsYXRlJykuaHRtbCgpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmVuZGVyKCkge1xyXG4gICAgICAgICAgICB0aGlzLiRlbC5odG1sKHRoaXMudGVtcGxhdGUodGhpcy5tb2RlbC50b0pTT04oKSkpO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5lZGl0aW5nKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgbHN2ID0gbmV3IExpbmVzU2VsZWN0VmlldztcclxuICAgICAgICAgICAgICAgIHZhciBsaW5lU2VsZWN0b3JIdG1sID0gbHN2LnJlbmRlcigpLmVsO1xyXG4gICAgICAgICAgICAgICAgdGhpcy4kZWwuZmluZCgnZGl2W2NsYXNzPWxpbmVTZWxlY3RdJylcclxuICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKGxpbmVTZWxlY3Rvckh0bWwpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgICAgIH1cclxuICAgICAgICBtb2RlbEVkaXQoKSB7XHJcbiAgICAgICAgICAgIHRoaXMudGVtcGxhdGUgPSBfLnRlbXBsYXRlKCQoJyNwcm9kdWN0TGlzdEVkaXQtdGVtcGxhdGUnKS5odG1sKCkpO1xyXG4gICAgICAgICAgICB0aGlzLmVkaXRpbmcgPSB0cnVlO1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlcigpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBtb2RlbFNhdmUoKSB7XHJcbiAgICAgICAgICAgIHRoaXMubW9kZWwuTmFtZSA9IHRoaXMuJGVsLmZpbmQoJ2lucHV0W25hbWU9TmFtZV0nKS52YWwoKTtcclxuICAgICAgICAgICAgdGhpcy5tb2RlbC5zYXZlKCk7XHJcbiAgICAgICAgICAgIHRoaXMuZWRpdGluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICB0aGlzLnRlbXBsYXRlID0gXy50ZW1wbGF0ZSgkKCcjcHJvZHVjdExpc3QtdGVtcGxhdGUnKS5odG1sKCkpO1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlcigpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBtb2RlbENhbmNlbCgpIHtcclxuICAgICAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IF8udGVtcGxhdGUoJCgnI3Byb2R1Y3RMaXN0LXRlbXBsYXRlJykuaHRtbCgpKTtcclxuICAgICAgICAgICAgdGhpcy5lZGl0aW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHRoaXMucmVuZGVyKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIG1vZGVsQWRkTGluZSgpIHtcclxuICAgICAgICAgICAgZGVidWdnZXI7XHJcbiAgICAgICAgICAgIHZhciBsaW5lSWQgPSBwYXJzZUludCh0aGlzLiRlbC5maW5kKCdkaXZbY2xhc3M9bGluZVNlbGVjdF0nKVxyXG4gICAgICAgICAgICAgICAgLmZpbmQoJ3NlbGVjdCcpLnZhbCgpKTtcclxuICAgICAgICAgICAgaWYgKGxpbmVJZCA+IDApIHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLm1vZGVsLkxpbmVzID09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLkxpbmVzID0gbmV3IEFycmF5PG1vZGVscy5Qcm9kdWN0TGluZT4oKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHZhciBwbCA9IG5ldyBtb2RlbHMuUHJvZHVjdExpbmU7XHJcbiAgICAgICAgICAgICAgICBwbC5Qcm9kdWN0SWQgPSB0aGlzLm1vZGVsLmlkO1xyXG4gICAgICAgICAgICAgICAgcGwuTGluZUlkID0gbGluZUlkO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5MaW5lcy5wdXNoKHBsKTtcclxuICAgICAgICAgICAgICAgIHRoaXMubW9kZWwuc2F2ZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIG1vZGVsRGVsZXRlTGluZShlPzogYW55KSB7XHJcbiAgICAgICAgICAgIGRlYnVnZ2VyO1xyXG4gICAgICAgICAgICB2YXIgbGluZUlkID0gcGFyc2VJbnQoJChlLnRhcmdldCkuYXR0cignZGF0YS1saW5lSWQnKSk7XHJcbiAgICAgICAgICAgIGlmIChsaW5lSWQgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLkxpbmVzID0gdGhpcy5tb2RlbC5MaW5lcy5maWx0ZXIoKHBsKSA9PiBwbC5MaW5lSWQgIT0gbGluZUlkKTtcclxuICAgICAgICAgICAgICAgIHRoaXMubW9kZWwuc2F2ZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIG1vZGVsRGVsZXRlKCkge1xyXG4gICAgICAgICAgICB0aGlzLm1vZGVsLmRlc3Ryb3koKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvLyBsaXN0IHZpZXdcclxuICAgIGV4cG9ydCBjbGFzcyBMaW5lc0xpc3RWaWV3IGV4dGVuZHMgYmIuVmlldzxtb2RlbHMuTGluZT4ge1xyXG4gICAgICAgIHJlbmRlcigpOiBiYi5WaWV3PG1vZGVscy5MaW5lPiB7XHJcbiAgICAgICAgICAgIC8vIGNsZWFyXHJcbiAgICAgICAgICAgIHRoaXMuJGVsLmh0bWwoJycpO1xyXG4gICAgICAgICAgICAvLyBjb2xsZWN0aW9uXHJcbiAgICAgICAgICAgIHRoaXMuY29sbGVjdGlvbi5lYWNoKGwgPT4ge1xyXG4gICAgICAgICAgICAgICAgLy8gYXBwZW5kIGl0XHJcbiAgICAgICAgICAgICAgICB2YXIgbGx3ID0gbmV3IExpbmVMaXN0VmlldztcclxuICAgICAgICAgICAgICAgIGxsdy5tb2RlbCA9IGw7XHJcbiAgICAgICAgICAgICAgICAvLyBcInZpZXcgY2hhaW5pbmdcIlxyXG4gICAgICAgICAgICAgICAgdGhpcy4kZWwuYXBwZW5kKGxsdy5yZW5kZXIoKS5lbCk7XHJcbiAgICAgICAgICAgIH0sIHRoaXMpO1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvLyBzaW5nbGUgaXRlbSBpbiBsaXN0XHJcbiAgICBleHBvcnQgY2xhc3MgTGluZUxpc3RWaWV3IGV4dGVuZHMgYmIuVmlldzxtb2RlbHMuTGluZT4ge1xyXG4gICAgICAgIHRlbXBsYXRlOiAoZGF0YTogYW55KSA9PiBzdHJpbmc7XHJcbiAgICAgICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZXZlbnRzID0gPGFueT4ge1xyXG4gICAgICAgICAgICAgICAgXCJjbGljayAuZWRpdEJ1dHRvblwiOiBcIm1vZGVsRWRpdFwiLFxyXG4gICAgICAgICAgICAgICAgXCJjbGljayAuZGVsZXRlQnV0dG9uXCI6IFwibW9kZWxEZWxldGVcIixcclxuICAgICAgICAgICAgICAgIFwiY2xpY2sgLnNhdmVCdXR0b25cIjogXCJtb2RlbFNhdmVcIixcclxuICAgICAgICAgICAgICAgIFwiY2xpY2sgLmNhbmNlbEJ1dHRvblwiOiBcIm1vZGVsQ2FuY2VsXCJcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgc3VwZXIoKTtcclxuICAgICAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IF8udGVtcGxhdGUoJCgnI2xpbmVMaXN0LXRlbXBsYXRlJykuaHRtbCgpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmVuZGVyKCkge1xyXG4gICAgICAgICAgICB0aGlzLiRlbC5odG1sKHRoaXMudGVtcGxhdGUodGhpcy5tb2RlbC50b0pTT04oKSkpO1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcclxuICAgICAgICB9XHJcbiAgICAgICAgbW9kZWxFZGl0KCkge1xyXG4gICAgICAgICAgICB0aGlzLnRlbXBsYXRlID0gXy50ZW1wbGF0ZSgkKCcjbGluZUxpc3RFZGl0LXRlbXBsYXRlJykuaHRtbCgpKTtcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXIoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgbW9kZWxTYXZlKCkge1xyXG4gICAgICAgICAgICB0aGlzLm1vZGVsLk5hbWUgPSB0aGlzLiRlbC5maW5kKCdpbnB1dFtuYW1lPU5hbWVdJykudmFsKCk7XHJcbiAgICAgICAgICAgIHRoaXMubW9kZWwuc2F2ZSgpO1xyXG4gICAgICAgICAgICB0aGlzLnRlbXBsYXRlID0gXy50ZW1wbGF0ZSgkKCcjbGluZUxpc3QtdGVtcGxhdGUnKS5odG1sKCkpO1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlcigpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBtb2RlbENhbmNlbCgpIHtcclxuICAgICAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IF8udGVtcGxhdGUoJCgnI2xpbmVMaXN0LXRlbXBsYXRlJykuaHRtbCgpKTtcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXIoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgbW9kZWxEZWxldGUoKSB7XHJcbiAgICAgICAgICAgIHRoaXMubW9kZWwuZGVzdHJveSgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8vIGFsdGVybmF0aXZlIGxpc3QgdmlldyBvZiBsaW5lcyBhcyA8c2VsZWN0PiBlbGVtZW50XHJcbiAgICBleHBvcnQgY2xhc3MgTGluZXNTZWxlY3RWaWV3IGV4dGVuZHMgYmIuVmlldzxtb2RlbHMuTGluZT4ge1xyXG4gICAgICAgIGNvbnN0cnVjdG9yKG9wdGlvbnM/OiBhbnkpIHtcclxuICAgICAgICAgICAgdGhpcy5jb2xsZWN0aW9uID0gbW9kZWxzLkNvbGxlY3Rpb25zKCkuTGluZXM7XHJcbiAgICAgICAgICAgIHN1cGVyKG9wdGlvbnMpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZW5kZXIoKTogYmIuVmlldzxtb2RlbHMuTGluZT4ge1xyXG4gICAgICAgICAgICAvLyBzZWxlY3RcclxuICAgICAgICAgICAgdGhpcy5lbCA9ICQoJzxzZWxlY3QgY2xhc3M9XCJvcHRpb25cIj4nKTtcclxuICAgICAgICAgICAgdGhpcy5jb2xsZWN0aW9uLmVhY2gobCA9PiB7XHJcbiAgICAgICAgICAgICAgICAvLyBvcHRpb25cclxuICAgICAgICAgICAgICAgIHZhciBsb3YgPSBuZXcgTGluZU9wdGlvblZpZXc7XHJcbiAgICAgICAgICAgICAgICBsb3YubW9kZWwgPSBsO1xyXG4gICAgICAgICAgICAgICAgLy8gYXBwZW5kXHJcbiAgICAgICAgICAgICAgICB0aGlzLmVsLmFwcGVuZChsb3YucmVuZGVyKCkuZWwpO1xyXG4gICAgICAgICAgICB9LCB0aGlzKTtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgZXhwb3J0IGNsYXNzIExpbmVPcHRpb25WaWV3IGV4dGVuZHMgYmIuVmlldzxtb2RlbHMuTGluZT4ge1xyXG4gICAgICAgIHJlbmRlcigpOiBiYi5WaWV3PG1vZGVscy5MaW5lPiB7XHJcbiAgICAgICAgICAgIHRoaXMuZWwgPSAkKCc8b3B0aW9uPicpO1xyXG4gICAgICAgICAgICB0aGlzLmVsLmF0dHIoJ3ZhbHVlJywgdGhpcy5tb2RlbC5pZCk7XHJcbiAgICAgICAgICAgIHRoaXMuZWwudGV4dCh0aGlzLm1vZGVsLk5hbWUpO1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvLyBzdGF0dXMgbGlzdCB2aWV3XHJcbiAgICBleHBvcnQgY2xhc3MgU3RhdHVzZXNMaXN0VmlldyBleHRlbmRzIGJiLlZpZXc8bW9kZWxzLlN0YXR1cz4ge1xyXG4gICAgICAgIGNvbnN0cnVjdG9yKG9wdGlvbnM/OiBhbnkpIHtcclxuICAgICAgICAgICAgc3VwZXIob3B0aW9ucyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJlbmRlcigpOiBiYi5WaWV3PG1vZGVscy5TdGF0dXM+IHtcclxuICAgICAgICAgICAgdGhpcy5jb2xsZWN0aW9uLmVhY2gocyA9PiB7XHJcbiAgICAgICAgICAgICAgICB2YXIgc2x2ID0gbmV3IFN0YXR1c0xpc3RWaWV3O1xyXG4gICAgICAgICAgICAgICAgc2x2Lm1vZGVsID0gcztcclxuICAgICAgICAgICAgICAgIHRoaXMuZWwuYXBwZW5kKHNsdi5yZW5kZXIoKS5lbCk7XHJcbiAgICAgICAgICAgIH0sIHRoaXMpO1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBleHBvcnQgY2xhc3MgU3RhdHVzTGlzdFZpZXcgZXh0ZW5kcyBiYi5WaWV3PG1vZGVscy5TdGF0dXM+IHtcclxuICAgICAgICB0ZW1wbGF0ZTogKGRhdGE6IGFueSkgPT4gc3RyaW5nO1xyXG4gICAgICAgIGNvbnN0cnVjdG9yKG9wdGlvbnM/OiBhbnkpIHtcclxuICAgICAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IF8udGVtcGxhdGUoJCgnI3N0YXR1c0xpc3QtdGVtcGxhdGUnKS5odG1sKCkpO1xyXG4gICAgICAgICAgICBzdXBlcihvcHRpb25zKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmVuZGVyKCk6IGJiLlZpZXc8bW9kZWxzLlN0YXR1cz4ge1xyXG4gICAgICAgICAgICB0aGlzLiRlbC5odG1sKHRoaXMudGVtcGxhdGUodGhpcy5tb2RlbC50b0pTT04oKSkpO1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=